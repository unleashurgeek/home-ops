### NOTE: This is not meant to be the desired cilium config, just the minimum necessary to make
### a healthy cluster with a working network
---
## Talos required settings
securityContext:
  privileged: true
  capabilities:
    ciliumAgent: "{CHOWN,KILL,NET_ADMIN,NET_RAW,IPC_LOCK,SYS_ADMIN,SYS_RESOURCE,DAC_OVERRIDE,FOWNER,SETGID,SETUID}"
    cleanCiliumState: "{NET_ADMIN,SYS_ADMIN,SYS_RESOURCE}"
cgroup:
  autoMount:
    enabled: false
  hostRoot: /sys/fs/cgroup

## Cluster Identification
cluster:
  name: main
  id: 1

## Allow fallback to another CNI
cni:
  exclusive: false

## Cilium networking internals (+ kube-proxy replacement)
ipam:
  mode: kubernetes
kubeProxyReplacement: strict
kubeProxyReplacementHealthzBindAddr: 0.0.0.0:10256
k8sServiceHost: localhost
k8sServicePort: 7445
# autoDirectNodeRoutes: true
# routingMode: native
# ipv4NativeRoutingCIDR: 10.244.0.0/16
# loadBalancer:
#   algorithm: maglev
#   mode: dsr

## Cilium automatic management upon ConfigMap update/resource changes
rollOutCiliumPods: true
operator:
  rollOutPods: true

# bpf:
#   masquerade: true
#   tproxy: true
# bgpControlPlane:
#   enabled: true
# localRedirectPolicy: true
# bandwidthManager:
#   enabled: true
#   bbr: true
# enableCnpStatusUpdates: true
# endpointStatus:
#   enabled: true
#   status: policy

## Hubble observability
hubble:
  enabled: true

  relay:
    enabled: true
    rollOutPods: true

  ui:
    enabled: false
    ingress:
      enabled: true
    rollOutPods: true